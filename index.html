<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Testing Hub V1.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root { --accent: #3b82f6; --bg-dark: #020617; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg-dark);
            background-image: radial-gradient(circle at 50% -20%, #1e293b, var(--bg-dark));
            color: #f8fafc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            backdrop-filter: blur(24px); 
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }
        .status-btn { 
            border: 1px solid rgba(255,255,255,0.05); 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-working.active { background: #10b981; border-color: #10b981; color: white; box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }
        .btn-bug.active { background: #ef4444; border-color: #ef4444; color: white; box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); }
        .btn-skip.active { background: #64748b; border-color: #64748b; color: white; }

        input, select, textarea {
            background: rgba(0, 0, 0, 0.3) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            transition: all 0.3s ease;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent) !important;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        .guide-box { border-left: 4px solid var(--accent); background: linear-gradient(to right, rgba(59, 130, 246, 0.08), transparent); }
        .step-animate { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="max-w-xl w-full glass-card rounded-[3rem] overflow-hidden border-white/10">
        <div class="h-2 bg-white/5 w-full">
            <div id="progressBar" class="h-full bg-blue-500 transition-all duration-700 shadow-[0_0_15px_rgba(59,130,246,0.6)]" style="width: 0%"></div>
        </div>

        <div class="p-10 pb-4 text-center">
            <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-blue-500/10 border border-blue-500/20 rounded-full mb-4">
                <span class="text-[10px] font-black tracking-[0.25em] text-blue-400 uppercase">Android Testing Hub</span>
            </div>
            <h1 class="text-4xl font-extrabold tracking-tighter text-white">V1.0 <span class="font-thin text-slate-500 italic">Core</span></h1>
        </div>

        <div id="step-setup" class="p-10 pt-4 space-y-6 step-animate">
            <div class="grid gap-5">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-tester">Tester Identity</label>
                    <input type="text" id="tgUser" placeholder="@username" class="w-full p-4 rounded-2xl text-sm font-medium">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-project">Project Name</label>
                    <input type="text" id="romName" placeholder="e.g. PixelOS v4.0" class="w-full p-4 rounded-2xl text-sm font-medium">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-device">Device</label>
                        <select id="deviceSelect" class="w-full p-4 rounded-2xl text-sm font-medium appearance-none">
                            <option value="Generic" id="opt-generic">Generic Device</option>
                            <option value="Redmi Note 12 Pro 4G">Redmi Note 12 Pro 4G</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-cat">Category</label>
                        <select id="testType" class="w-full p-4 rounded-2xl text-sm font-medium appearance-none">
                            <option value="ROM">ROM</option>
                            <option value="Kernel">Kernel</option>
                            <option value="Recovery">Recovery</option>
                        </select>
                    </div>
                </div>
            </div>
            <button onclick="startTesting()" class="w-full bg-blue-600 hover:bg-blue-500 p-5 rounded-2xl font-bold text-sm transition-all shadow-xl uppercase tracking-[0.2em]" id="btn-begin">Begin Session</button>
            
            <div class="pt-4 border-t border-white/5 flex justify-center">
                <button onclick="toggleLang()" class="flex items-center gap-2 text-[10px] font-bold text-slate-500 hover:text-blue-400 transition-colors uppercase tracking-widest">
                    <i class="fa-solid fa-globe"></i> <span id="langBtnText">Switch to Indonesia</span>
                </button>
            </div>
        </div>

        <div id="step-testing" class="hidden p-10 pt-2 step-animate">
            <div class="flex justify-between items-center mb-6">
                <div class="px-4 py-1.5 bg-white/5 rounded-xl border border-white/10">
                    <span id="pageIndicator" class="mono text-[11px] font-bold text-blue-400">TASK 01/18</span>
                </div>
                <button onclick="toggleLogModal()" class="text-[10px] font-black text-amber-500 uppercase tracking-widest border-b border-amber-500/30" id="btn-log-help">Log Help</button>
            </div>

            <div class="mb-6">
                <h2 id="currentQuestion" class="text-2xl font-extrabold text-white mb-4 tracking-tight">Feature</h2>
                <div class="guide-box p-5 space-y-3">
                    <p id="guideDesc" class="text-xs text-slate-400 leading-relaxed italic font-medium"></p>
                    <div class="pt-3 border-t border-white/5">
                        <span class="text-[9px] font-black text-blue-400 uppercase tracking-[0.2em] block mb-1" id="lbl-howcheck">Check Guide:</span>
                        <p id="guideStep" class="text-xs text-white font-semibold"></p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-3 gap-3">
                    <button onclick="setStatus('Working')" id="btn-Working" class="status-btn btn-working p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest">Working</button>
                    <button onclick="setStatus('Bug')" id="btn-Bug" class="status-btn btn-bug p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest">Bug</button>
                    <button onclick="setStatus('Not Tested')" id="btn-Not-Tested" class="status-btn btn-skip p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest">Skip</button>
                </div>
                <textarea id="currentComment" oninput="saveCurrentData()" class="w-full p-5 rounded-[2rem] h-24 outline-none text-sm resize-none" placeholder="Notes..."></textarea>
                <div class="flex items-center gap-4">
                    <input type="file" id="currentPhoto" accept="image/*" onchange="handlePhotoUpload(this)" class="hidden">
                    <label for="currentPhoto" class="cursor-pointer flex-1 flex items-center justify-center p-4 rounded-2xl border-2 border-dashed border-slate-800 hover:border-blue-500 hover:bg-blue-500/5 transition-all">
                        <span id="photoLabel" class="text-[10px] font-bold uppercase text-slate-500">Attach Screenshot</span>
                    </label>
                    <div id="photoPreviewContainer" class="hidden relative">
                        <img id="imagePreview" src="#" class="w-14 h-14 object-cover rounded-xl border border-white/10">
                        <button onclick="clearPhoto()" class="absolute -top-2 -right-2 bg-red-500 text-white w-5 h-5 rounded-full text-[8px] flex items-center justify-center"><i class="fa-solid fa-x"></i></button>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="prevQuestion()" class="px-6 py-4 rounded-2xl font-bold text-[10px] text-slate-500 hover:text-white transition uppercase tracking-widest" id="btn-back">Back</button>
                <button id="nextBtn" onclick="nextQuestion()" class="flex-1 bg-white text-black p-4 rounded-2xl font-black text-[10px] transition-all uppercase tracking-[0.2em]">Next Task</button>
            </div>
        </div>

        <div id="step-finish" class="hidden p-10 step-animate">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-500/20 shadow-lg shadow-blue-500/10">
                    <i class="fa-solid fa-cloud-arrow-down text-2xl text-blue-400"></i>
                </div>
                <h2 class="text-2xl font-extrabold uppercase tracking-tighter" id="lbl-export">Export Package</h2>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em] mt-1">Ready for submission</p>
            </div>

            <div class="bg-black/30 rounded-[2rem] p-6 border border-white/5 space-y-4 mb-6">
                <div class="flex justify-between items-center text-xs">
                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest" id="lbl-sum-proj">Project</span>
                    <span id="sumROM" class="font-bold text-blue-400 text-right"></span>
                </div>
                <div class="flex justify-between items-center text-xs">
                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest" id="lbl-sum-test">Tester</span>
                    <span id="sumTester" class="font-bold text-white text-right"></span>
                </div>
            </div>

            <div class="p-6 bg-blue-500/5 rounded-[2rem] border border-blue-500/10 mb-8">
                <label class="text-[10px] font-black text-blue-400 uppercase block mb-4 text-center tracking-widest italic" id="lbl-attach">Attach System Log (Optional)</label>
                <div class="relative group">
                    <input type="file" id="mainLog" onchange="updateFileName(this)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                    <div class="flex items-center justify-between p-4 bg-slate-900/80 rounded-xl border border-white/10 group-hover:border-blue-500 transition-all">
                        <span id="fileNameDisplay" class="text-[10px] text-slate-500 truncate mr-2 font-medium" id="lbl-no-file">No file chosen...</span>
                        <div class="bg-blue-600 px-4 py-2 rounded-lg text-[9px] font-black uppercase text-white shadow-lg shadow-blue-900/20" id="lbl-browse">Browse</div>
                    </div>
                </div>
            </div>

            <button onclick="generateZip()" class="w-full bg-blue-600 hover:bg-blue-500 p-5 rounded-2xl font-black text-xs tracking-[0.2em] transition-all uppercase shadow-xl" id="btn-download">Download ZIP Package</button>
            <button onclick="location.reload()" class="w-full mt-4 text-slate-600 hover:text-red-400 text-[10px] font-bold uppercase tracking-widest transition" id="btn-reset">New Session</button>
        </div>
    </div>

    <div id="logModal" class="fixed inset-0 bg-black/95 backdrop-blur-2xl z-50 flex items-center justify-center p-6 hidden">
        <div class="bg-slate-900 max-w-sm w-full rounded-[2.5rem] border border-white/10 p-10">
            <h3 class="text-xl font-extrabold text-amber-500 uppercase tracking-tight mb-6" id="lbl-modal-title">Log Guide</h3>
            <div class="space-y-4">
                <div class="p-4 bg-black/50 rounded-xl border border-white/5">
                    <p class="text-blue-400 text-[9px] font-black uppercase tracking-widest mb-2"># System Log</p>
                    <code class="text-[10px] text-slate-300 block mono">adb logcat -d > log.txt</code>
                </div>
                <div class="p-4 bg-black/50 rounded-xl border border-white/5">
                    <p class="text-emerald-400 text-[9px] font-black uppercase tracking-widest mb-2"># Kernel Log</p>
                    <code class="text-[10px] text-slate-300 block mono">adb shell dmesg > dmesg.txt</code>
                </div>
            </div>
            <button onclick="toggleLogModal()" class="w-full mt-8 bg-slate-800 p-4 rounded-xl font-bold uppercase text-[10px] tracking-widest" id="btn-close">Close</button>
        </div>
    </div>

    <script>
        let currentLang = 'en';
        const i18n = {
            en: {
                langBtn: "Switch to Indonesia",
                tester: "Tester Identity", project: "Project Name", device: "Device", cat: "Category", 
                begin: "Begin Session", how: "Check Guide:", back: "Back", next: "Next Task", 
                finish: "Export", export: "Export Package", attach: "Attach System Log (Optional)", 
                download: "Download ZIP Package", reset: "New Session", logg: "Log Guide", 
                photo: "Attach Screenshot", generic: "Generic Device", placeholder: "Notes...",
                sumProj: "Project", sumTest: "Tester", noFile: "No file chosen...", browse: "Browse",
                modalTitle: "Log Guide", close: "Close", error: "Please fill in all required fields!"
            },
            id: {
                langBtn: "Ganti ke Bahasa Inggris",
                tester: "Identitas Tester", project: "Nama Proyek", device: "Perangkat", cat: "Kategori", 
                begin: "Mulai Sesi", how: "Panduan Cek:", back: "Kembali", next: "Tugas Lanjut", 
                finish: "Ekspor", export: "Ekspor Paket", attach: "Lampirkan Log Sistem (Opsional)", 
                download: "Unduh Paket ZIP", reset: "Sesi Baru", logg: "Panduan Log", 
                photo: "Lampirkan Screenshot", generic: "Perangkat Umum", placeholder: "Catatan temuan...",
                sumProj: "Proyek", sumTest: "Tester", noFile: "Belum ada file...", browse: "Pilih File",
                modalTitle: "Panduan Log", close: "Tutup", error: "Harap isi semua kolom wajib!"
            }
        };

        const testSets = {
            "ROM": [
                { q: "System UI Stability", en_d: "The interface should not lag or restart when swiping status bar.", id_d: "Antarmuka tidak boleh lag atau restart saat swipe status bar.", en_s: "Working: Smooth swipe. Check: Open many apps and pull down notification bar repeatedly.", id_s: "Working: Swipe lancar. Cara Cek: Buka banyak aplikasi dan tarik bar notifikasi berulang kali." },
                { q: "RIL: Signal & Data", en_d: "Mobile data must be stable with 4G/5G icon visible.", id_d: "Data seluler harus stabil dengan ikon 4G/5G muncul.", en_s: "Working: Internet works. Check: Disable Wi-Fi, open YouTube, and browse for 1 minute.", id_s: "Working: Internet jalan. Cara Cek: Matikan Wi-Fi, buka YouTube, dan browsing selama 1 menit." },
                { q: "Google Play Integrity", en_d: "Device should pass security checks for banking apps.", id_d: "Perangkat harus lolos cek keamanan untuk aplikasi bank.", en_s: "Working: 'MEETS_DEVICE_INTEGRITY'. Check: Download 'YASNAC' app from Play Store and Run.", id_s: "Working: Lolos Integrity. Cara Cek: Download aplikasi 'YASNAC' di Play Store dan Run." },
                { q: "Biometrics (FP/Face)", en_d: "Fast and accurate unlocking without failed attempts.", id_d: "Buka kunci cepat dan akurat tanpa sering gagal.", en_s: "Working: Unlocks in <1s. Check: Register fingers/face and try unlocking 5 times in a row.", id_s: "Working: Buka <1 detik. Cara Cek: Daftarkan jari/wajah dan coba buka 5 kali berturut-turut." },
                { q: "Widevine Level", en_d: "Determines if you can watch Netflix in Full HD.", id_d: "Menentukan apakah bisa nonton Netflix Full HD.", en_s: "Working: L1. Check: Open 'DRM Info' app and check 'Security Level'.", id_s: "Working: L1. Cara Cek: Buka aplikasi 'DRM Info' dan cek bagian 'Security Level'." },
                { q: "Bluetooth Audio", en_d: "Clean sound without stuttering on TWS/Speakers.", id_d: "Suara jernih tanpa putus-putus di TWS/Speaker.", en_s: "Working: No delay. Check: Connect Bluetooth headphones and play music for 30 seconds.", id_s: "Working: Tidak delay. Cara Cek: Hubungkan headphone Bluetooth dan putar musik 30 detik." },
                { q: "Wi-Fi & Hotspot", en_d: "Able to connect to Wi-Fi and share internet.", id_d: "Bisa konek ke Wi-Fi dan berbagi internet.", en_s: "Working: Hotspot active. Check: Turn on Hotspot and connect another device to it.", id_s: "Working: Hotspot aktif. Cara Cek: Hidupkan Hotspot dan hubungkan perangkat lain." },
                { q: "GPS Accuracy", en_d: "Precise location tracking for Maps.", id_d: "Pelacakan lokasi yang presisi untuk Maps.", en_s: "Working: Accurate location. Check: Open Google Maps and tap 'My Location' icon.", id_s: "Working: Lokasi akurat. Cara Cek: Buka Google Maps dan tekan ikon 'Lokasi Saya'." },
                { q: "Battery Idle Drain", en_d: "Battery should not drop much when screen is off.", id_d: "Baterai tidak boleh turun banyak saat layar mati.", en_s: "Working: <2% per hour. Check: Check battery percentage, leave for 30 mins, check again.", id_s: "Working: <2% per jam. Cara Cek: Catat baterai, diamkan 30 menit, cek lagi." },
                { q: "Camera App", en_d: "Taking photos and videos should be smooth.", id_d: "Ambil foto dan video harus lancar.", en_s: "Working: No crash. Check: Open camera, take 3 photos, and record a 10s video.", id_s: "Working: Tidak crash. Cara Cek: Buka kamera, ambil 3 foto, dan rekam video 10 detik." },
                { q: "Flashlight", en_d: "LED light should turn on from Quick Settings.", id_d: "Lampu LED harus menyala dari Pengaturan Cepat.", en_s: "Working: Bright LED. Check: Toggle flashlight icon in status bar.", id_s: "Working: LED terang. Cara Cek: Tekan ikon senter di bar status." },
                { q: "Audio Jack / USB-C", en_d: "Music through wired headphones.", id_d: "Musik melalui kabel headphone.", en_s: "Working: Sound out. Check: Plug in earphones and listen for any noise.", id_s: "Working: Suara keluar. Cara Cek: Colok earphone dan dengarkan jika ada noise." },
                { q: "Display Brightness", en_d: "Smooth transition from dark to bright.", id_d: "Transisi lancar dari gelap ke terang.", en_s: "Working: Auto works. Check: Move slider and test auto-brightness under a light.", id_s: "Working: Auto jalan. Cara Cek: Geser slider dan tes auto-bright di bawah lampu." },
                { q: "Dark Mode", en_d: "System apps should change colors correctly.", id_d: "Aplikasi sistem harus ganti warna dengan benar.", en_s: "Working: All black. Check: Enable Dark Mode and open Settings/Phone apps.", id_s: "Working: Hitam semua. Cara Cek: Aktifkan Dark Mode dan buka menu Setelan." },
                { q: "Charging Speed", en_d: "Detects 'Fast Charging' or 'Turbo' animation.", id_d: "Mendeteksi animasi 'Fast Charging' atau 'Turbo'.", en_s: "Working: Fast. Check: Connect original charger and see lockscreen text.", id_s: "Working: Cepat. Cara Cek: Colok charger ori dan lihat teks di lockscreen." },
                { q: "Microphone", en_d: "Clear voice recording without static.", id_d: "Rekaman suara jernih tanpa statik.", en_s: "Working: Clear. Check: Open 'Recorder' app and say 'Testing 1 2 3'.", id_s: "Working: Jernih. Cara Cek: Buka aplikasi 'Perekam' dan bicara 'Tes 1 2 3'." },
                { q: "Vibration/Haptics", en_d: "Haptics feel tight, not buzzy.", id_d: "Getaran terasa padat, tidak berisik.", en_s: "Working: Tactile. Check: Type on keyboard and feel the vibration.", id_s: "Working: Taktil. Cara Cek: Ketik di keyboard dan rasakan getarannya." },
                { q: "Internal Storage", en_d: "Files can be moved and deleted.", id_d: "File bisa dipindah dan dihapus.", en_s: "Working: Writable. Check: Create a folder in File Manager and delete it.", id_s: "Working: Bisa ditulis. Cara Cek: Buat folder di File Manager lalu hapus." }
            ],
            "Kernel": [
                { q: "Deep Sleep", en_d: "CPU sleeps to save power.", id_d: "CPU tidur untuk hemat daya.", en_s: "Working: Active. Check: See clock in CPU-Z or Franco Kernel Manager.", id_s: "Working: Aktif. Cara Cek: Lihat clock di CPU-Z saat layar mati sebentar." },
                { q: "Charging mA", en_d: "Stable current during charging.", id_d: "Arus stabil saat mengecas.", en_s: "Working: >2000mA. Check: Use 'Ampere' app while charging.", id_s: "Working: >2000mA. Cara Cek: Gunakan aplikasi 'Ampere' saat cas." }
            ],
            "Recovery": [
                { q: "Data Decryption", en_d: "Can see folders in /sdcard.", id_d: "Bisa lihat folder di /sdcard.", en_s: "Working: Names ok. Check: Open 'Install' menu, see file names.", id_s: "Working: Nama ok. Cara Cek: Buka menu 'Install', lihat nama file." }
            ]
        };

        let questions = [];
        let currentIndex = 0;
        let testData = {};

        function toggleLang() {
            currentLang = (currentLang === 'en') ? 'id' : 'en';
            const dict = i18n[currentLang];
            
            // Navbar & Setup
            document.getElementById('langBtnText').innerText = dict.langBtn;
            document.getElementById('lbl-tester').innerText = dict.tester;
            document.getElementById('lbl-project').innerText = dict.project;
            document.getElementById('lbl-device').innerText = dict.device;
            document.getElementById('lbl-cat').innerText = dict.cat;
            document.getElementById('opt-generic').innerText = dict.generic;
            document.getElementById('btn-begin').innerText = dict.begin;
            
            // Testing Interface
            document.getElementById('lbl-howcheck').innerText = dict.how;
            document.getElementById('btn-back').innerText = dict.back;
            document.getElementById('btn-log-help').innerText = dict.logg;
            document.getElementById('photoLabel').innerText = dict.photo;
            document.getElementById('currentComment').placeholder = dict.placeholder;
            
            // Finish Interface
            document.getElementById('lbl-export').innerText = dict.export;
            document.getElementById('lbl-sum-proj').innerText = dict.sumProj;
            document.getElementById('lbl-sum-test').innerText = dict.sumTest;
            document.getElementById('lbl-attach').innerText = dict.attach;
            document.getElementById('lbl-browse').innerText = dict.browse;
            document.getElementById('btn-download').innerText = dict.download;
            document.getElementById('btn-reset').innerText = dict.reset;

            // Modal
            document.getElementById('lbl-modal-title').innerText = dict.modalTitle;
            document.getElementById('btn-close').innerText = dict.close;

            if(questions.length > 0) updatePage();
        }

        function updateFileName(input) {
            const display = document.getElementById('fileNameDisplay');
            display.innerText = input.files[0] ? input.files[0].name : (i18n[currentLang].noFile);
            display.classList.remove('text-slate-500');
            display.classList.add('text-blue-400');
        }

        function startTesting() {
            const rom = document.getElementById('romName').value;
            const tg = document.getElementById('tgUser').value;
            if(!rom || !tg) return alert(i18n[currentLang].error);
            const type = document.getElementById('testType').value;
            questions = [...testSets[type]];
            questions.forEach(q => { if(!testData[q.q]) testData[q.q] = { status: "Not Tested", comment: "", photo: null }; });
            document.getElementById('step-setup').classList.add('hidden');
            document.getElementById('step-testing').classList.remove('hidden');
            updatePage();
        }

        function updatePage() {
            const q = questions[currentIndex];
            document.getElementById('currentQuestion').innerText = q.q;
            document.getElementById('guideDesc').innerText = q[currentLang + '_d'];
            document.getElementById('guideStep').innerText = q[currentLang + '_s'];
            document.getElementById('pageIndicator').innerText = `TASK ${String(currentIndex + 1).padStart(2,'0')}/${questions.length}`;
            document.getElementById('currentComment').value = testData[q.q].comment || "";
            updateStatusButtons(testData[q.q].status);
            if(testData[q.q].photo) document.getElementById('photoPreviewContainer').classList.remove('hidden');
            else document.getElementById('photoPreviewContainer').classList.add('hidden');
            document.getElementById('nextBtn').innerText = (currentIndex === questions.length - 1) ? i18n[currentLang].finish : i18n[currentLang].next;
            document.getElementById('progressBar').style.width = ((currentIndex + 1) / questions.length) * 100 + '%';
        }

        function setStatus(status) { testData[questions[currentIndex].q].status = status; updateStatusButtons(status); saveCurrentData(); }
        function saveCurrentData() { testData[questions[currentIndex].q].comment = document.getElementById('currentComment').value; }
        function updateStatusButtons(status) {
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.id === `btn-${status.replace(/\s+/g, '-')}`) btn.classList.add('active');
            });
        }
        function handlePhotoUpload(input) { if (input.files && input.files[0]) { testData[questions[currentIndex].q].photo = input.files[0]; updatePage(); } }
        function clearPhoto() { testData[questions[currentIndex].q].photo = null; updatePage(); }
        function toggleLogModal() { document.getElementById('logModal').classList.toggle('hidden'); }
        function prevQuestion() {
            if(currentIndex > 0) { currentIndex--; updatePage(); } 
            else { document.getElementById('step-testing').classList.add('hidden'); document.getElementById('step-setup').classList.remove('hidden'); }
        }
        function nextQuestion() {
            saveCurrentData();
            if(currentIndex < questions.length - 1) { currentIndex++; updatePage(); } 
            else { 
                document.getElementById('step-testing').classList.add('hidden'); 
                document.getElementById('step-finish').classList.remove('hidden');
                document.getElementById('sumTester').innerText = document.getElementById('tgUser').value;
                document.getElementById('sumROM').innerText = document.getElementById('romName').value;
            }
        }
        async function generateZip() {
            const zip = new JSZip();
            const rom = document.getElementById('romName').value.replace(/\s+/g, '_');
            let report = `=== ATH V1.0 REPORT ===\nPROJECT: ${rom}\nTESTER: ${document.getElementById('tgUser').value}\n\n`;
            const imgFolder = zip.folder("evidence");
            for (const qObj of questions) {
                const item = testData[qObj.q];
                report += `[${item.status.toUpperCase()}] ${qObj.q}\nNotes: ${item.comment || "-"}\n`;
                if(item.photo) {
                    const ext = item.photo.name.split('.').pop();
                    const fileName = `${qObj.q.replace(/\s+/g, '_')}.${ext}`;
                    imgFolder.file(fileName, item.photo);
                    report += `Media: evidence/${fileName}\n`;
                }
                report += `------------------------------------\n`;
            }
            zip.file("SUMMARY_V1.txt", report);
            const mainLog = document.getElementById('mainLog').files[0];
            if(mainLog) zip.file(mainLog.name, mainLog);
            const blob = await zip.generateAsync({type:"blob"});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${rom}-Report.zip`;
            link.click();
            confetti({ particleCount: 200, spread: 70, origin: { y: 0.6 } });
        }
    </script>
</body>
</html>
