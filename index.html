<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Testing Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: radial-gradient(circle at top right, #1e293b, #0f172a); }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .gradient-text { background: linear-gradient(90deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .status-btn.active { border-color: #3b82f6; background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        #logModal { display: none; }
        #logModal.show { display: flex; }
    </style>
</head>
<body class="text-gray-100 min-h-screen p-4 flex flex-col items-center justify-center overflow-x-hidden">

    <div class="max-w-2xl w-full glass rounded-3xl shadow-2xl overflow-hidden relative">
        <div class="h-1 bg-gray-800 w-full">
            <div id="progressBar" class="h-full bg-blue-500 transition-all duration-500" style="width: 10%"></div>
        </div>

        <div class="p-8 pb-4 text-center">
            <h1 class="text-2xl font-extrabold uppercase tracking-tighter gradient-text">Android Testing Suite</h1>
            <p class="text-gray-400 text-xs mt-1 font-medium italic">Provide the best logs for developers</p>
        </div>

        <div id="step-setup" class="p-8 pt-4 space-y-6">
            <div class="space-y-4">
                <input type="text" id="tgUser" placeholder="Telegram @username" class="w-full bg-gray-900/50 p-3 rounded-xl border border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 transition">
                <input type="text" id="romName" placeholder="ROM / Kernel Name" class="w-full bg-gray-900/50 p-3 rounded-xl border border-gray-700 outline-none focus:ring-2 focus:ring-blue-500 transition">
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <select id="deviceSelect" class="bg-gray-900/50 p-3 rounded-xl border border-gray-700 outline-none">
                        <option value="Generic">Generic Device</option>
                        <option value="Redmi Note 12 Pro 4G">Redmi Note 12 Pro 4G (sweet2)</option>
                    </select>
                    <select id="testType" class="bg-gray-900/50 p-3 rounded-xl border border-gray-700 outline-none">
                        <option value="ROM">Custom ROM</option>
                        <option value="Kernel">Kernel</option>
                        <option value="Recovery">Recovery</option>
                    </select>
                </div>
            </div>
            <button onclick="startTesting()" class="w-full bg-blue-600 p-4 rounded-2xl font-bold hover:scale-[1.02] transition uppercase shadow-lg shadow-blue-500/20">Initialize Session</button>
        </div>

        <div id="step-testing" class="hidden p-8 pt-4">
            <div class="flex justify-between items-center mb-4">
                <span id="pageIndicator" class="mono text-[10px] bg-blue-500/10 text-blue-400 px-3 py-1 rounded-full border border-blue-500/20 italic">Task 1/10</span>
                <button onclick="toggleLogModal()" class="text-[10px] bg-amber-500/10 text-amber-400 px-3 py-1 rounded-full border border-amber-500/20 font-bold hover:bg-amber-500/20 transition">
                    <i class="fa-solid fa-circle-info mr-1"></i> LOG GUIDE
                </button>
            </div>

            <h2 id="currentQuestion" class="text-3xl font-bold mb-6 tracking-tight text-white leading-tight h-16 flex items-center">Feature</h2>
            
            <div class="space-y-5">
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setStatus('Working')" id="btn-Working" class="status-btn p-3 rounded-xl border border-gray-700 bg-gray-900/30 text-xs transition">Working</button>
                    <button onclick="setStatus('Bug')" id="btn-Bug" class="status-btn p-3 rounded-xl border border-gray-700 bg-gray-900/30 text-xs transition">Bug</button>
                    <button onclick="setStatus('Not Tested')" id="btn-Not-Tested" class="status-btn p-3 rounded-xl border border-gray-700 bg-gray-900/30 text-xs transition active">Not Tested</button>
                </div>

                <textarea id="currentComment" oninput="saveCurrentData()" placeholder="Add notes or bug details here..." class="w-full bg-gray-900/50 p-4 rounded-xl border border-gray-700 h-28 outline-none focus:ring-1 focus:ring-blue-500 text-sm"></textarea>

                <div class="space-y-2">
                    <input type="file" id="currentPhoto" accept="image/*" onchange="handlePhotoUpload(this)" class="hidden">
                    <label for="currentPhoto" class="cursor-pointer w-full flex items-center justify-center p-3 rounded-xl border border-dashed border-gray-600 bg-gray-900/20 text-xs hover:border-blue-500 transition text-gray-400">
                        <i class="fa-solid fa-camera mr-2 text-blue-400"></i> <span id="photoLabel">Attach Screenshot</span>
                    </label>
                    <div id="photoPreviewContainer" class="hidden mt-4 relative text-center">
                        <img id="imagePreview" src="#" class="max-h-40 rounded-xl border border-gray-700 shadow-xl mx-auto">
                        <button onclick="clearPhoto()" class="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full text-[10px]"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="prevQuestion()" class="flex-1 bg-gray-800 p-4 rounded-2xl font-bold text-gray-500 hover:text-white transition uppercase text-xs">Back</button>
                <button id="nextBtn" onclick="nextQuestion()" class="flex-[2] bg-blue-600 p-4 rounded-2xl font-bold shadow-lg shadow-blue-500/20 uppercase transition">Next</button>
            </div>
        </div>

        <div id="step-finish" class="hidden p-8 space-y-6">
            <div class="text-center">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-500/20 rounded-full mb-4">
                    <i class="fa-solid fa-file-zipper text-2xl text-blue-400"></i>
                </div>
                <h2 class="text-2xl font-bold">Session Finalized</h2>
                <p class="text-xs text-gray-400">Review your information before exporting</p>
            </div>

            <div class="bg-gray-900/40 border border-gray-700 rounded-2xl p-5 space-y-3 mono text-[11px]">
                <div class="flex justify-between border-b border-gray-800 pb-2">
                    <span class="text-gray-500 uppercase">Tester</span>
                    <span id="sumTester" class="text-blue-400 font-bold"></span>
                </div>
                <div class="flex justify-between border-b border-gray-800 pb-2">
                    <span class="text-gray-500 uppercase">Project</span>
                    <span id="sumROM" class="text-purple-400 font-bold"></span>
                </div>
                <div class="flex justify-between border-b border-gray-800 pb-2">
                    <span class="text-gray-500 uppercase">Device</span>
                    <span id="sumDevice" class="text-emerald-400 font-bold"></span>
                </div>
                <div class="flex justify-between border-b border-gray-800 pb-2">
                    <span class="text-gray-500 uppercase">Timestamp</span>
                    <span id="sumTime" class="text-gray-300"></span>
                </div>
            </div>

            <div class="bg-gray-900/50 p-6 rounded-2xl border border-gray-800 text-left">
                <label class="text-[10px] text-gray-500 uppercase block mb-2 font-bold tracking-widest">Optional Logcat/Dmesg (.txt/.log)</label>
                <input type="file" id="mainLog" class="w-full text-xs text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-gray-800 file:text-blue-400 font-bold cursor-pointer">
            </div>

            <button id="downloadBtn" onclick="generateZip()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 p-5 rounded-2xl font-black tracking-widest shadow-xl shadow-blue-500/20 hover:scale-[1.02] transition">DOWNLOAD PACKAGE</button>
            <button onclick="resetData()" class="w-full text-red-500 text-[10px] uppercase font-bold tracking-widest opacity-50 hover:opacity-100 transition">Discard & Retest</button>
        </div>
    </div>

    <div id="logModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 items-center justify-center p-6">
        <div class="bg-gray-800 max-w-md w-full rounded-3xl border border-gray-700 p-8 space-y-4 shadow-2xl">
            <h3 class="text-xl font-bold text-amber-400 flex items-center gap-2 uppercase tracking-tighter">
                <i class="fa-solid fa-terminal"></i> Log Capture Guide
            </h3>
            <div class="space-y-3 text-xs leading-relaxed text-gray-300">
                <p>If you encounter a <strong>Bug</strong>, run these commands via ADB immediately after it happens:</p>
                <div class="bg-black p-4 rounded-xl mono text-blue-300 border border-gray-700 space-y-2">
                    <p class="text-[10px] text-gray-500 uppercase"># UI / Crash Logs</p>
                    <code class="block">adb logcat -d > logcat.txt</code>
                    <p class="text-[10px] text-gray-500 uppercase mt-2"># Hardware / Kernel Logs</p>
                    <code class="block">adb shell dmesg > dmesg.txt</code>
                </div>
                <p class="italic text-gray-400">Upload these files in the final stage of this suite.</p>
            </div>
            <button onclick="toggleLogModal()" class="w-full bg-blue-600 p-3 rounded-xl font-bold hover:bg-blue-700 transition">UNDERSTOOD</button>
        </div>
    </div>

    <script>
        const genericTests = ["RIL (Signal/Call/Data)", "Wi-Fi Connectivity", "Bluetooth Connectivity", "Camera (Photo/Video)", "Audio (Speaker/Earpiece)", "Microphone", "GPS Accuracy", "Biometrics (Fingerprint/Face)", "Flashlight", "USB MTP/OTG", "Video Playback"];
        const sweet2Tests = ["108MP Mode", "120Hz Display", "67W Turbo Charge", "Dolby Atmos", "IR Blaster", "Proximity Sensor", "NFC Functionality", "SD Card Slot"];

        let questions = [];
        let currentIndex = 0;
        let testData = {};

        function startTesting() {
            if(!document.getElementById('romName').value || !document.getElementById('tgUser').value) return alert("Fill in Tester & ROM Name.");
            const dev = document.getElementById('deviceSelect').value;
            questions = (dev === "Generic") ? [...genericTests] : [...genericTests, ...sweet2Tests];
            questions.forEach(q => { if(!testData[q]) testData[q] = { status: "Not Tested", comment: "", photo: null }; });
            document.getElementById('step-setup').classList.add('hidden');
            document.getElementById('step-testing').classList.remove('hidden');
            updatePage();
        }

        function toggleLogModal() { document.getElementById('logModal').classList.toggle('show'); }

        function setStatus(status) {
            testData[questions[currentIndex]].status = status;
            saveCurrentData();
            updateStatusButtons(status);
        }

        function updateStatusButtons(status) {
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-400', 'bg-blue-500/10');
                if(btn.id === `btn-${status.replace(/\s+/g, '-')}`) btn.classList.add('active', 'border-blue-500', 'text-blue-400', 'bg-blue-500/10');
            });
        }

        function handlePhotoUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('photoPreviewContainer').classList.remove('hidden');
                    document.getElementById('photoLabel').innerText = "Evidence Attached";
                    testData[questions[currentIndex]].photo = input.files[0];
                    saveCurrentData();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function clearPhoto() {
            testData[questions[currentIndex]].photo = null;
            document.getElementById('currentPhoto').value = "";
            document.getElementById('photoPreviewContainer').classList.add('hidden');
            document.getElementById('photoLabel').innerText = "Attach Screenshot";
            saveCurrentData();
        }

        function updatePage() {
            const q = questions[currentIndex];
            document.getElementById('currentQuestion').innerText = q;
            document.getElementById('pageIndicator').innerText = `Task ${currentIndex + 1}/${questions.length}`;
            document.getElementById('currentComment').value = testData[q].comment;
            updateStatusButtons(testData[q].status);
            const container = document.getElementById('photoPreviewContainer');
            if(testData[q].photo) {
                const reader = new FileReader();
                reader.onload = (e) => { document.getElementById('imagePreview').src = e.target.result; container.classList.remove('hidden'); };
                reader.readAsDataURL(testData[q].photo);
            } else { container.classList.add('hidden'); document.getElementById('photoLabel').innerText = "Attach Screenshot"; }
            document.getElementById('nextBtn').innerText = (currentIndex === questions.length - 1) ? "FINISH" : "NEXT";
            updateProgress();
        }

        function saveCurrentData() {
            testData[questions[currentIndex]].comment = document.getElementById('currentComment').value;
        }

        function nextQuestion() {
            if(currentIndex < questions.length - 1) { currentIndex++; updatePage(); } 
            else { 
                document.getElementById('step-testing').classList.add('hidden'); 
                document.getElementById('step-finish').classList.remove('hidden');
                
                // Show Summary Page Info
                const now = new Date();
                document.getElementById('sumTester').innerText = document.getElementById('tgUser').value;
                document.getElementById('sumROM').innerText = document.getElementById('romName').value;
                document.getElementById('sumDevice').innerText = document.getElementById('deviceSelect').value;
                document.getElementById('sumTime').innerText = now.toLocaleString();
            }
        }

        function prevQuestion() {
            if(currentIndex > 0) { currentIndex--; updatePage(); } 
            else { document.getElementById('step-testing').classList.add('hidden'); document.getElementById('step-setup').classList.remove('hidden'); }
        }

        function updateProgress() {
            const val = ((currentIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = val + '%';
        }

        async function generateZip() {
            const btn = document.getElementById('downloadBtn');
            btn.innerHTML = '<i class="fa-solid fa-cog fa-spin"></i> GENERATING PACKAGE...';
            btn.disabled = true;

            try {
                const zip = new JSZip();
                const now = new Date();
                const tg = document.getElementById('tgUser').value;
                const rom = document.getElementById('romName').value;
                const device = document.getElementById('deviceSelect').value;
                const type = document.getElementById('testType').value;
                
                // Formatted Filename
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.getHours().toString().padStart(2,'0') + now.getMinutes().toString().padStart(2,'0');
                const zipName = `${rom.replace(/\s+/g, '_')}-${tg}-${dateStr}-${timeStr}.zip`;

                let report = `=== ANDROID QUALITY ASSURANCE REPORT ===\n`;
                report += `DATE    : ${now.toLocaleDateString()}\n`;
                report += `TIME    : ${now.toLocaleTimeString()}\n`;
                report += `TESTER  : ${tg}\n`;
                report += `PROJECT : ${rom}\n`;
                report += `DEVICE  : ${device}\n`;
                report += `TYPE    : ${type}\n`;
                report += `========================================\n\n`;
                
                const imgFolder = zip.folder("screenshots");
                for (const q of questions) {
                    const item = testData[q];
                    report += `[${item.status.toUpperCase()}] ${q}\nNote: ${item.comment || "-"}\n`;
                    if(item.photo) {
                        const ext = item.photo.name.split('.').pop();
                        const photoName = `${q.replace(/\s+/g, '_')}.${ext}`;
                        imgFolder.file(photoName, item.photo);
                        report += `Media: screenshots/${photoName}\n`;
                    }
                    report += `----------------------------------------\n`;
                }

                zip.file("SUMMARY_REPORT.txt", report);
                const mainLog = document.getElementById('mainLog').files[0];
                if(mainLog) zip.file(`logs/${mainLog.name}`, mainLog);

                const blob = await zip.generateAsync({type:"blob"});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = zipName;
                link.click();
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#60a5fa', '#a78bfa', '#10b981'] });
            } finally {
                btn.innerHTML = 'DOWNLOAD PACKAGE';
                btn.disabled = false;
            }
        }

        function resetData() { if(confirm("Discard results and restart?")) { location.reload(); } }
    </script>
</body>
</html>
