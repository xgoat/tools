<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Testing Hub V1.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root { --accent: #3b82f6; --bg-dark: #020617; --radius: 3rem; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg-dark);
            background-image: radial-gradient(circle at 50% -20%, #1e293b, var(--bg-dark));
            color: #f8fafc;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.7); 
            backdrop-filter: blur(24px); 
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
        }
        .status-btn.active { box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); transform: scale(0.98); }
        .btn-working.active { background: #10b981; border-color: #10b981; color: white; }
        .btn-bug.active { background: #ef4444; border-color: #ef4444; color: white; }
        .btn-skip.active { background: #64748b; border-color: #64748b; color: white; }

        input, select, textarea {
            background: rgba(0, 0, 0, 0.3) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: white !important;
            transition: all 0.3s ease;
        }
        
        .guide-box { 
            border-radius: var(--radius);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(15, 23, 42, 0.5));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .floating-lang {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .floating-lang:hover { transform: scale(1.1) rotate(15deg); }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        
        .step-animate { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="floating-lang" onclick="toggleLang()">
        <i class="fa-solid fa-language text-white text-xl"></i>
    </div>

    <div class="max-w-xl w-full glass-card rounded-[var(--radius)] overflow-hidden border-white/10">
        <div class="h-2 bg-white/5 w-full">
            <div id="progressBar" class="h-full bg-blue-500 transition-all duration-700 shadow-[0_0_15px_rgba(59,130,246,0.6)]" style="width: 0%"></div>
        </div>

        <div class="p-10 pb-4 text-center">
            <div class="inline-flex items-center gap-2 px-4 py-1.5 bg-blue-500/10 border border-blue-500/20 rounded-full mb-4">
                <span class="text-[10px] font-black tracking-[0.25em] text-blue-400 uppercase">Android Testing Hub</span>
            </div>
            <h1 class="text-4xl font-extrabold tracking-tighter text-white">V1.0 <span class="font-thin text-slate-500 italic">Core</span></h1>
        </div>

        <div id="step-setup" class="p-10 pt-4 space-y-6 step-animate">
            <div class="grid gap-5">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-tester">Tester Identity</label>
                    <input type="text" id="tgUser" placeholder="@username" class="w-full p-4 rounded-2xl text-sm font-medium">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-project">Project Name</label>
                    <input type="text" id="romName" placeholder="e.g. PixelOS v4.0" class="w-full p-4 rounded-2xl text-sm font-medium">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-device">Device</label>
                        <select id="deviceSelect" class="w-full p-4 rounded-2xl text-sm font-medium appearance-none cursor-pointer">
                            <option value="Generic" id="opt-generic">Generic Device</option>
                            <option value="Redmi Note 12 Pro 4G">Redmi Note 12 Pro 4G</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-1 mb-2 block" id="lbl-cat">Category</label>
                        <select id="testType" class="w-full p-4 rounded-2xl text-sm font-medium appearance-none cursor-pointer">
                            <option value="ROM">ROM</option>
                            <option value="Kernel">Kernel</option>
                            <option value="Recovery">Recovery</option>
                        </select>
                    </div>
                </div>
            </div>
            <button onclick="startTesting()" class="w-full bg-blue-600 hover:bg-blue-500 p-5 rounded-2xl font-bold text-sm transition-all shadow-xl uppercase tracking-[0.2em]" id="btn-begin">Begin Session</button>
        </div>

        <div id="step-testing" class="hidden p-10 pt-2 step-animate">
            <div class="flex justify-between items-center mb-6">
                <div class="px-4 py-1.5 bg-white/5 rounded-xl border border-white/10">
                    <span id="pageIndicator" class="mono text-[11px] font-bold text-blue-400">TASK 01/18</span>
                </div>
                <button onclick="toggleLogModal()" class="text-[10px] font-black text-amber-500 uppercase tracking-widest border-b border-amber-500/30" id="btn-log-help">Log Guide</button>
            </div>

            <div class="mb-6">
                <h2 id="currentQuestion" class="text-2xl font-extrabold text-white mb-4 tracking-tight">Feature</h2>
                <div class="guide-box p-8 space-y-4">
                    <p id="guideDesc" class="text-xs text-slate-300 leading-relaxed italic font-medium"></p>
                    <div class="pt-4 border-t border-white/10">
                        <span class="text-[9px] font-black text-blue-400 uppercase tracking-[0.2em] block mb-2" id="lbl-howcheck">Check Guide:</span>
                        <p id="guideStep" class="text-xs text-white font-semibold leading-relaxed"></p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <div class="grid grid-cols-3 gap-3">
                    <button onclick="setStatus('Working')" id="btn-Working" class="status-btn btn-working p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest border border-white/5 bg-white/5">Working</button>
                    <button onclick="setStatus('Bug')" id="btn-Bug" class="status-btn btn-bug p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest border border-white/5 bg-white/5">Bug</button>
                    <button onclick="setStatus('Not Tested')" id="btn-Not-Tested" class="status-btn btn-skip p-4 rounded-2xl text-[10px] font-black uppercase tracking-widest border border-white/5 bg-white/5">Skip</button>
                </div>
                <textarea id="currentComment" oninput="saveCurrentData()" class="w-full p-5 rounded-[2rem] h-24 outline-none text-sm resize-none custom-scrollbar" placeholder="Notes..."></textarea>
                <div class="flex items-center gap-4">
                    <input type="file" id="currentPhoto" accept="image/*" onchange="handlePhotoUpload(this)" class="hidden">
                    <label for="currentPhoto" class="cursor-pointer flex-1 flex items-center justify-center p-4 rounded-2xl border-2 border-dashed border-slate-800 hover:border-blue-500 hover:bg-blue-500/5 transition-all">
                        <span id="photoLabel" class="text-[10px] font-bold uppercase text-slate-500">Attach Screenshot</span>
                    </label>
                    <div id="photoPreviewContainer" class="hidden relative">
                        <img id="imagePreview" src="#" class="w-14 h-14 object-cover rounded-xl border border-white/10">
                        <button onclick="clearPhoto()" class="absolute -top-2 -right-2 bg-red-500 text-white w-5 h-5 rounded-full text-[8px] flex items-center justify-center"><i class="fa-solid fa-x"></i></button>
                    </div>
                </div>
            </div>

            <div class="flex gap-4 mt-8">
                <button onclick="prevQuestion()" class="px-6 py-4 rounded-2xl font-bold text-[10px] text-slate-500 hover:text-white transition uppercase tracking-widest" id="btn-back">Back</button>
                <button id="nextBtn" onclick="nextQuestion()" class="flex-1 bg-white text-black p-4 rounded-2xl font-black text-[10px] transition-all uppercase tracking-[0.2em] shadow-lg">Next Task</button>
            </div>
        </div>

        <div id="step-finish" class="hidden p-10 step-animate">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-500/20 shadow-lg shadow-blue-500/10">
                    <i class="fa-solid fa-cloud-arrow-down text-2xl text-blue-400"></i>
                </div>
                <h2 class="text-2xl font-extrabold uppercase tracking-tighter" id="lbl-export">Export Package</h2>
                <p class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em] mt-1">Review & Build Report</p>
            </div>

            <div class="bg-black/30 rounded-[2rem] p-6 border border-white/5 space-y-3 mb-6">
                <div class="flex justify-between items-center text-xs">
                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest" id="lbl-sum-proj">Project</span>
                    <span id="sumROM" class="font-bold text-blue-400"></span>
                </div>
                <div class="flex justify-between items-center text-xs">
                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest" id="lbl-sum-cat">Category</span>
                    <span id="sumCategory" class="font-bold text-amber-400"></span>
                </div>
                <div class="flex justify-between items-center text-xs">
                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest" id="lbl-sum-test">Tester</span>
                    <span id="sumTester" class="font-bold text-white"></span>
                </div>
            </div>

            <div class="mb-6 rounded-[1.5rem] border border-white/5 bg-white/5 overflow-hidden">
                <button onclick="togglePreview()" class="w-full p-4 flex justify-between items-center bg-white/5 hover:bg-white/10 transition-colors">
                    <span class="text-[10px] font-black uppercase tracking-widest text-slate-400" id="lbl-preview-results">Preview Results</span>
                    <i id="previewIcon" class="fa-solid fa-chevron-down text-[10px] text-slate-500"></i>
                </button>
                <div id="previewContent" class="hidden max-h-48 overflow-y-auto p-4 space-y-2 mono text-[9px] custom-scrollbar"></div>
            </div>

            <div class="p-6 bg-blue-500/5 rounded-[2rem] border border-blue-500/10 mb-8">
                <label class="text-[10px] font-black text-blue-400 uppercase block mb-4 text-center tracking-widest" id="lbl-attach">Attach System Log (Optional)</label>
                <div class="relative group">
                    <input type="file" id="mainLog" onchange="updateFileName(this)" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                    <div class="flex items-center justify-between p-4 bg-slate-900/80 rounded-xl border border-white/10 group-hover:border-blue-500 transition-all">
                        <span id="fileNameDisplay" class="text-[10px] text-slate-500 truncate mr-2 font-medium" id="lbl-no-file">No file chosen...</span>
                        <div class="bg-blue-600 px-4 py-2 rounded-lg text-[9px] font-black uppercase text-white shadow-lg" id="lbl-browse">Browse</div>
                    </div>
                </div>
            </div>

            <button onclick="generateZip()" class="w-full bg-blue-600 hover:bg-blue-500 p-5 rounded-2xl font-black text-xs tracking-[0.2em] transition-all uppercase shadow-xl" id="btn-download">Download ZIP Package</button>
            <button onclick="location.reload()" class="w-full mt-4 text-slate-600 hover:text-red-400 text-[10px] font-bold uppercase tracking-widest transition" id="btn-reset">New Session</button>
        </div>
    </div>

    <div id="logModal" class="fixed inset-0 bg-black/95 backdrop-blur-2xl z-50 flex items-center justify-center p-6 hidden">
        <div class="bg-slate-900 max-w-lg w-full rounded-[2.5rem] border border-white/10 p-8 max-h-[90vh] overflow-y-auto custom-scrollbar">
            <h3 class="text-2xl font-extrabold text-amber-500 uppercase tracking-tight mb-4" id="lbl-modal-title">Detailed Log Guide</h3>
            
            <div class="space-y-6">
                <div>
                    <p class="text-blue-400 text-[10px] font-black uppercase tracking-widest mb-2">1. Enable USB Debugging</p>
                    <div class="bg-black/40 p-4 rounded-xl text-[11px] text-slate-300 space-y-1">
                        <p>â€¢ Go to <span class="text-white">Settings > About Phone</span></p>
                        <p>â€¢ Tap <span class="text-white">Build Number</span> 7 times</p>
                        <p>â€¢ Go to <span class="text-white">Developer Options > Enable USB Debugging</span></p>
                    </div>
                </div>

                <div>
                    <p class="text-emerald-400 text-[10px] font-black uppercase tracking-widest mb-2">2. Connect to PC</p>
                    <div class="bg-black/40 p-4 rounded-xl text-[11px] text-slate-300">
                        <p>Connect cable, and run <code class="bg-black px-1 rounded text-white font-mono">adb devices</code> in terminal. Accept the prompt on phone screen.</p>
                    </div>
                </div>

                <div>
                    <p class="text-amber-400 text-[10px] font-black uppercase tracking-widest mb-2">3. Extract Logs (Commands)</p>
                    <div class="space-y-3">
                        <div class="bg-black/60 p-4 rounded-xl border border-white/5">
                            <p class="text-[9px] text-slate-500 mb-2 uppercase">System Crashes / Framework Errors:</p>
                            <code class="text-[11px] text-blue-300 block mono">adb logcat -d > logcat.txt</code>
                        </div>
                        <div class="bg-black/60 p-4 rounded-xl border border-white/5">
                            <p class="text-[9px] text-slate-500 mb-2 uppercase">Kernel / Boot / Hardware Issues:</p>
                            <code class="text-[11px] text-emerald-300 block mono">adb shell dmesg > dmesg.txt</code>
                        </div>
                    </div>
                </div>

                <div class="bg-amber-500/10 p-4 rounded-xl border border-amber-500/20">
                    <p class="text-[10px] text-amber-500 font-bold uppercase mb-1">ðŸ’¡ Pro Tip</p>
                    <p class="text-[11px] text-slate-400 leading-relaxed">If the bug is reproducible, run <code class="text-white">adb logcat -c</code> first to clear old logs, then reproduce the bug, then run the extract command.</p>
                </div>
            </div>

            <button onclick="toggleLogModal()" class="w-full mt-8 bg-white text-black p-4 rounded-xl font-black uppercase text-[11px] tracking-widest hover:bg-blue-50 transition-colors" id="btn-close">Got it, thanks!</button>
        </div>
    </div>

    <script>
        let currentLang = 'en';
        const i18n = {
            en: {
                tester: "Tester Identity", project: "Project Name", device: "Device", cat: "Category", 
                begin: "Begin Session", how: "Check Guide:", back: "Back", next: "Next Task", 
                finish: "Export", export: "Export Package", attach: "Attach System Log (Optional)", 
                download: "Download ZIP Package", reset: "New Session", logg: "Log Help", 
                photo: "Attach Screenshot", generic: "Generic Device", placeholder: "Notes...",
                sumProj: "Project", sumCat: "Category", sumTest: "Tester", noFile: "No file chosen...", browse: "Browse",
                modalTitle: "Detailed Log Guide", close: "Got it, thanks!", error: "Required fields missing!", preview: "Preview Results"
            },
            id: {
                tester: "Identitas Tester", project: "Nama Proyek", device: "Perangkat", cat: "Kategori", 
                begin: "Mulai Sesi", how: "Panduan Cek:", back: "Kembali", next: "Lanjut", 
                finish: "Ekspor", export: "Ekspor Paket", attach: "Lampirkan Log Sistem (Opsional)", 
                download: "Unduh ZIP Report", reset: "Sesi Baru", logg: "Bantuan Log", 
                photo: "Lampirkan Screenshot", generic: "Perangkat Umum", placeholder: "Catatan temuan...",
                sumProj: "Proyek", sumCat: "Kategori", sumTest: "Tester", noFile: "Belum ada file...", browse: "Cari",
                modalTitle: "Panduan Log Detail", close: "Siap, Terimakasih!", error: "Kolom wajib harus diisi!", preview: "Pratinjau Hasil"
            }
        };

        const testSets = {
            "ROM": [
                { q: "System UI Stability", en_d: "The interface should not lag or restart when swiping status bar.", id_d: "Antarmuka tidak boleh lag atau restart saat swipe status bar.", en_s: "Working: Smooth swipe. Check: Pull down notification bar repeatedly.", id_s: "Working: Swipe lancar. Cara Cek: Tarik bar notifikasi berulang kali." },
                { q: "Google Play Integrity", en_d: "Device should pass security checks for banking apps.", id_d: "Perangkat harus lolos cek keamanan untuk aplikasi bank.", en_s: "Working: MEETS_DEVICE_INTEGRITY. Check: Run YASNAC app.", id_s: "Working: Lolos Integrity. Cara Cek: Jalankan aplikasi YASNAC." },
                { q: "Biometrics (FP/Face)", en_d: "Fast and accurate unlocking without failed attempts.", id_d: "Buka kunci cepat dan akurat tanpa sering gagal.", en_s: "Working: Unlocks <1s. Check: Try unlocking 5 times in a row.", id_s: "Working: Buka <1 detik. Cara Cek: Coba buka 5 kali berturut-turut." },
                { q: "Widevine Level", en_d: "Determines if you can watch Netflix in Full HD.", id_d: "Menentukan apakah bisa nonton Netflix Full HD.", en_s: "Working: L1. Check: Open DRM Info app.", id_s: "Working: L1. Cara Cek: Buka aplikasi DRM Info." },
                { q: "Bluetooth Audio", en_d: "Clean sound without stuttering on TWS/Speakers.", id_d: "Suara jernih tanpa putus-putus di TWS/Speaker.", en_s: "Working: No delay. Check: Connect Bluetooth headphones and play music.", id_s: "Working: Tidak delay. Cara Cek: Koneksi TWS dan putar musik." },
                { q: "Wi-Fi & Hotspot", en_d: "Able to connect to Wi-Fi and share internet.", id_d: "Bisa konek ke Wi-Fi dan berbagi internet.", en_s: "Working: Hotspot active. Check: Share data to another device.", id_s: "Working: Hotspot aktif. Cara Cek: Berbagi data ke perangkat lain." },
                { q: "GPS Accuracy", en_d: "Precise location tracking for Maps.", id_d: "Pelacakan lokasi yang presisi untuk Maps.", en_s: "Working: Accurate. Check: Open Google Maps and tap 'My Location'.", id_s: "Working: Akurat. Cara Cek: Buka Google Maps dan tap 'Lokasi Saya'." },
                { q: "Battery Idle Drain", en_d: "Battery should not drop much when screen is off.", id_d: "Baterai tidak boleh turun banyak saat layar mati.", en_s: "Working: <1% per hour. Check: Check % drop over 1 hour idle.", id_s: "Working: <1% per jam. Cara Cek: Cek penurunan % saat idle 1 jam." },
                { q: "Charging Speed", en_d: "Detects 'Fast Charging' or 'Turbo' animation.", id_d: "Mendeteksi animasi 'Fast Charging' atau 'Turbo'.", en_s: "Working: Fast. Check: Connect original charger.", id_s: "Working: Cepat. Cara Cek: Hubungkan charger original." }
            ],
            "Kernel": [
                { q: "Deep Sleep", en_d: "CPU sleeps to save power.", id_d: "CPU tidur untuk hemat daya.", en_s: "Working: Active. Check: Use CPU-Z to monitor sleep state.", id_s: "Working: Aktif. Cara Cek: Gunakan CPU-Z untuk pantau mode tidur." },
                { q: "Charging mA", en_d: "Stable current during charging.", id_d: "Arus stabil saat mengecas.", en_s: "Working: High mA. Check: Use 'Ampere' app while charging.", id_s: "Working: mA tinggi. Cara Cek: Gunakan aplikasi 'Ampere'." }
            ],
            "Recovery": [
                { q: "Data Decryption", en_d: "Can see folders in /sdcard.", id_d: "Bisa lihat folder di /sdcard.", en_s: "Working: Folders visible. Check: Open Install menu in Recovery.", id_s: "Working: Folder terlihat. Cara Cek: Buka menu Install di Recovery." }
            ]
        };

        let questions = [];
        let currentIndex = 0;
        let testData = {};

        function toggleLang() {
            currentLang = (currentLang === 'en') ? 'id' : 'en';
            const dict = i18n[currentLang];
            document.querySelectorAll("[id^='lbl-'], [id^='btn-'], [id^='opt-']").forEach(el => {
                const key = el.id.split('-').slice(1).reduce((acc, part, i) => i === 0 ? part : acc + part.charAt(0).toUpperCase() + part.slice(1), "");
                if(dict[key]) el.innerText = dict[key];
            });
            document.getElementById('currentComment').placeholder = dict.placeholder;
            if(questions.length > 0) updatePage();
        }

        function updateFileName(input) {
            const display = document.getElementById('fileNameDisplay');
            display.innerText = input.files[0] ? input.files[0].name : (i18n[currentLang].noFile);
            display.className = "text-[10px] truncate mr-2 font-medium text-blue-400";
        }

        function togglePreview() {
            const content = document.getElementById('previewContent');
            const icon = document.getElementById('previewIcon');
            content.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }

        function startTesting() {
            const rom = document.getElementById('romName').value;
            const tg = document.getElementById('tgUser').value;
            if(!rom || !tg) return alert(i18n[currentLang].error);
            const type = document.getElementById('testType').value;
            questions = [...testSets[type]];
            questions.forEach(q => { if(!testData[q.q]) testData[q.q] = { status: "Not Tested", comment: "", photo: null }; });
            document.getElementById('step-setup').classList.add('hidden');
            document.getElementById('step-testing').classList.remove('hidden');
            updatePage();
        }

        function updatePage() {
            const q = questions[currentIndex];
            document.getElementById('currentQuestion').innerText = q.q;
            document.getElementById('guideDesc').innerText = q[currentLang + '_d'];
            document.getElementById('guideStep').innerText = q[currentLang + '_s'];
            document.getElementById('pageIndicator').innerText = `TASK ${String(currentIndex + 1).padStart(2,'0')}/${questions.length}`;
            document.getElementById('currentComment').value = testData[q.q].comment || "";
            updateStatusButtons(testData[q.q].status);
            if(testData[q.q].photo) document.getElementById('photoPreviewContainer').classList.remove('hidden');
            else document.getElementById('photoPreviewContainer').classList.add('hidden');
            document.getElementById('nextBtn').innerText = (currentIndex === questions.length - 1) ? i18n[currentLang].finish : i18n[currentLang].next;
            document.getElementById('progressBar').style.width = ((currentIndex + 1) / questions.length) * 100 + '%';
        }

        function setStatus(status) { testData[questions[currentIndex].q].status = status; updateStatusButtons(status); saveCurrentData(); }
        function saveCurrentData() { if(questions[currentIndex]) testData[questions[currentIndex].q].comment = document.getElementById('currentComment').value; }
        function updateStatusButtons(status) {
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.id === `btn-${status.replace(/\s+/g, '-')}`) btn.classList.add('active');
            });
        }
        function handlePhotoUpload(input) { if (input.files && input.files[0]) { testData[questions[currentIndex].q].photo = input.files[0]; updatePage(); } }
        function clearPhoto() { testData[questions[currentIndex].q].photo = null; updatePage(); }
        function toggleLogModal() { document.getElementById('logModal').classList.toggle('hidden'); }
        function prevQuestion() {
            if(currentIndex > 0) { currentIndex--; updatePage(); } 
            else { document.getElementById('step-testing').classList.add('hidden'); document.getElementById('step-setup').classList.remove('hidden'); }
        }
        function nextQuestion() {
            saveCurrentData();
            if(currentIndex < questions.length - 1) { currentIndex++; updatePage(); } 
            else { 
                document.getElementById('step-testing').classList.add('hidden'); 
                document.getElementById('step-finish').classList.remove('hidden');
                document.getElementById('sumTester').innerText = document.getElementById('tgUser').value;
                document.getElementById('sumROM').innerText = document.getElementById('romName').value;
                document.getElementById('sumCategory').innerText = document.getElementById('testType').value;
                buildPreview();
            }
        }

        function buildPreview() {
            const container = document.getElementById('previewContent');
            container.innerHTML = "";
            questions.forEach(q => {
                const data = testData[q.q];
                const color = data.status === 'Working' ? 'text-emerald-400' : (data.status === 'Bug' ? 'text-red-400' : 'text-slate-500');
                container.innerHTML += `
                    <div class="border-b border-white/5 py-3">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-white font-bold uppercase tracking-tighter">${q.q}</span>
                            <span class="${color} font-black text-[8px]">${data.status.toUpperCase()}</span>
                        </div>
                        <p class="text-slate-500 italic text-[8px]">${data.comment || "---"}</p>
                    </div>`;
            });
        }

        async function generateZip() {
            const zip = new JSZip();
            const rom = document.getElementById('romName').value.replace(/\s+/g, '_');
            const now = new Date();
            
            let report = `============================================\n`;
            report += `    ATH V1.0 - DETAILED TEST REPORT\n`;
            report += `============================================\n`;
            report += `PROJECT  : ${document.getElementById('romName').value}\n`;
            report += `CATEGORY : ${document.getElementById('testType').value}\n`;
            report += `DEVICE   : ${document.getElementById('deviceSelect').value}\n`;
            report += `TESTER   : ${document.getElementById('tgUser').value}\n`;
            report += `TIMESTAMP: ${now.toLocaleString()}\n`;
            report += `============================================\n\n`;

            const imgFolder = zip.folder("evidence");
            questions.forEach((qObj, index) => {
                const item = testData[qObj.q];
                report += `[TASK ${index + 1}] ${qObj.q.toUpperCase()}\n`;
                report += `STATUS   : ${item.status}\n`;
                report += `GUIDE    : ${qObj.en_d}\n`;
                report += `FINDINGS : ${item.comment || "No detailed notes provided."}\n`;
                if(item.photo) {
                    const ext = item.photo.name.split('.').pop();
                    const fileName = `${qObj.q.replace(/\s+/g, '_')}.${ext}`;
                    imgFolder.file(fileName, item.photo);
                    report += `ATTACHED : evidence/${fileName}\n`;
                }
                report += `--------------------------------------------\n`;
            });

            report += `\nReport generated by Android Testing Hub Engine.`;
            zip.file("testing_result.txt", report);
            const mainLog = document.getElementById('mainLog').files[0];
            if(mainLog) zip.file(mainLog.name, mainLog);

            const blob = await zip.generateAsync({type:"blob"});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ATH_Report_${rom}.zip`;
            link.click();
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
        }
    </script>
</body>
</html>
